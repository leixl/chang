(function(c){var b=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;function a(){var e=document.createElement("p");var d=false;if(e.addEventListener){e.addEventListener("DOMAttrModified",function(){d=true},false)}else{if(e.attachEvent){e.attachEvent("onDOMAttrModified",function(){d=true})}else{return false}}e.setAttribute("id","target");return d}c.fn.attrchange=function(f){if(b){var e={subtree:false,attributes:true};var d=new b(function(g){g.forEach(function(h){f.call(h.target,h.attributeName)})});return this.each(function(){d.observe(this,e)})}else{if(a()){return this.bind("DOMAttrModified",function(g){f.call(this,g.attrName)})}else{if("onpropertychange" in document.body){return this.bind("propertychange",function(g){f.call(this,window.event.propertyName)})}}}}})(jQuery);(function(g,j){var h="localstorage";var a={set:function(n,o){var m=new Date();var l;if(o===null){m.setTime(m.getTime()-(365*24*60*60*1000*10))}else{m.setTime(m.getTime()+(365*24*60*60*1000))}l=";expires="+m.toGMTString();j.cookie=[n,"=",o,l,";domain=.douban.com;path=/"].join("")},get:function(m){var n=j.cookie.split(";"),o,p,l;for(l=0;l<n.length;l++){o=n[l].split("=");if(o.shift().replace(/\s/g,"")===m){p=o.join("=")}}return p},remove:function(l){if(this.get(l)){this.set(l,null)}}};var k={set:function(l,m){},get:function(l){},remove:function(l){},cookie:a};var d=function(l){return function(){var o=Array.prototype.slice.call(arguments,0);i.appendChild(f);f.addBehavior("#default#userData");var n=new Date();n.setDate(n.getDate()+365);f.expires=n.toUTCString();f.load(h);var m=l.apply(k,[f].concat(o));i.removeChild(f);return m}};if("localStorage" in g){k.set=function(l,m){g.localStorage.setItem(l,m)};k.get=function(l){return g.localStorage.getItem(l)};k.remove=function(l){g.localStorage.removeItem(l)}}else{if(j.documentElement.addBehavior){var e,i,f;try{var e=new ActiveXObject("htmlfile");e.open();e.write('<script>document.win=window<script><iframe src="/favicon.ico"></iframe>');e.close();i=e.win.frames[0].document;f=e.createElement("div")}catch(c){i=j.body;f=j.createElement("div")}k.set=d(function(n,l,m){n.setAttribute(l,m);n.save(h);return m});k.get=d(function(m,l){return m.getAttribute(l)});k.remove=d(function(m,l){m.removeAttribute(l);m.save(h);return val})}else{k.set=a.set;k.get=a.get;k.remove=a.remove}}var b=g.Douban||{};b.store=k;g.Douban=b})(window,document);(function(){var b=0;var a=/[^a-z0-9_]/ig;window.SwfStore=function(f){f=f||{};var h={swf_url:"storage.swf",namespace:"swfstore",path:null,debug:false,timeout:10,onready:null,onerror:null};var l;for(l in h){if(h.hasOwnProperty(l)){if(!f.hasOwnProperty(l)){f[l]=h[l]}}}f.namespace=f.namespace.replace(a,"_");if(window.SwfStore[f.namespace]){throw"There is already an instance of SwfStore using the '"+f.namespace+"' namespace. Use that instance or specify an alternate namespace in the config."}this.config=f;function e(){return"SwfStore_"+f.namespace+"_"+(b++)}function d(n){var m=document.createElement("div");document.body.appendChild(m);m.id=e();if(!n){m.style.position="absolute";m.style.top="-2000px";m.style.left="-2000px"}return m}if(f.debug){if(typeof console==="undefined"){var i=d(true);window.console={log:function(o){var n=d(true);n.innerHTML=o;i.appendChild(n)}}}this.log=function(m,n,o){n=(n==="swfStore")?"swf":n;if(typeof(console[m])!=="undefined"){console[m]("SwfStore - "+f.namespace+" ("+n+"): "+o)}else{console.log("SwfStore - "+f.namespace+": "+m+" ("+n+"): "+o)}}}else{this.log=function(){}}this.log("info","js","Initializing...");SwfStore[f.namespace]=this;var k=d(f.debug);var j=e();var g="logfn=SwfStore."+f.namespace+".log&amp;onload=SwfStore."+f.namespace+".onload&amp;onerror=SwfStore."+f.namespace+".onerror&amp;"+(f.path?"LSOPath="+f.path+"&amp;":"")+"LSOName="+f.namespace;k.innerHTML='<object height="100" width="500" codebase="https://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+j+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000">	<param value="'+f.swf_url+'" name="movie">	<param value="'+g+'" name="FlashVars">	<param value="always" name="allowScriptAccess">	<embed height="375" align="middle" width="500" pluginspage="https://www.macromedia.com/go/getflashplayer" flashvars="'+g+'" type="application/x-shockwave-flash" allowscriptaccess="always" quality="high" loop="false" play="true" name="'+j+'" bgcolor="#ffffff" src="'+f.swf_url+'"></object>';this.swf=document[j]||window[j];this._timeout=setTimeout(function(){SwfStore[f.namespace].log("error","js","Timeout reached, assuming "+f.swf_url+" failed to load and firing the onerror callback.");if(f.onerror){f.onerror()}},f.timeout*1000)};function c(d){if(typeof d==="function"){throw"SwfStore Error: Functions cannot be used as keys or values."}}SwfStore.prototype={version:"1.7",ready:false,set:function(d,e){this._checkReady();c(d);c(e);this.swf.set(d,e)},get:function(d){this._checkReady();c(d);return this.swf.get(d)},getAll:function(){this._checkReady();var d=this.swf.getAll();if(d.__flashBugFix){delete d.__flashBugFix}return d},clear:function(d){this._checkReady();c(d);this.swf.clear(d)},_checkReady:function(){if(!this.ready){throw"SwfStore is not yet finished initializing. Pass a config.onready callback or wait until this.ready is true before trying to use a SwfStore instance."}},onload:function(){var d=this;setTimeout(function(){clearTimeout(d._timeout);d.ready=true;d.set("__flashBugFix","1");if(d.config.onready){d.config.onready()}},0)},onerror:function(){clearTimeout(this._timeout);if(this.config.onerror){this.config.onerror()}}}}());store=new SwfStore({namespace:"dstat",swf_url:_dstat.store_url,onready:function(){store.ready=true;var a=store.get("bid");if(!a){a=Douban.store.cookie.get("bid");store.set("bid",a.replace(/\"/g,""))}_dstat.bid=a;delete _dstat.store_url;$.dstat.send("pv")},onerror:function(){}});(function(h){if(!window._dstat){return}var D=".s";var a="pv";var r="expose";var m="click";var x="collect";var v="areaid";var p="mode";var b="params";var t=_dstat.url_pv||"http://dclk.douban.com/pv?";var c=_dstat.url_expose||"http://dclk.douban.com/exp?";var d=_dstat.url_click||"http://dclk.douban.com/clk?";var g=window;var s=h(g);var o={expose:[],click:[]};var y=false;var i=function(F){return{get:function(G){return F.data("dstat-"+G)},set:function(G,H){F.data("dstat-"+G,H)}}};var n=function(G,F){var H;return function(J){var I=this;if(H){window.clearTimeout(H)}H=window.setTimeout(function(){G.call(I,J)},F||100)}};var e=function(F){return{add:function(I){var G=i(F);var H=G.get("watchid");if(typeof H==="undefined"){H=e.elements.length;G.set("watchid",H);e.elements.push([])}e.elements[H].push(I)},get:function(){return e.elements[(i(F)).get("watchid")]}}};e.elements=[];var C=function(I,G){if(typeof I==="string"){G=I}else{if(!I){return}}var F={};F[a]=function(J){if(J){(new Image()).src=t+J}};F[m]=function(J){if(J){(new Image()).src=d+J}};F[r]=function(J){if(J){(new Image()).src=c+J}};var H={};H[a]=function(){return u(h.extend({},_dstat))};H[m]=function(){return u(h.extend({},l.cache[m],_dstat))};H[r]=function(){return u(h.extend({},l.cache[r],_dstat))};if(G){F[G](H[G]())}else{F[m](I[1]);F[r](I[2])}};var B=function(){if(!store.ready){return}store.set("click",u(h.extend({},l.cache[m],_dstat)));store.set("expose",u(h.extend({},l.cache[r],_dstat)))};var l=function(J,I,H){H=H||0;var G=l.cache[J]=l.cache[J]||{};var F=function(L,K){L=L||",";if(L.indexOf(","+K+",")<0){L+=K+","}return L};G.area_ids=F(G.area_ids,I);G[I]=G[I]||{};G[I+"_params"]=H;C(J)};l.cache={};_logExposeTime=function(H,G){var F=l.cache[r][H];F.expose_duration=F.expose_duration||0;F.expose_duration+=G};var u=function(G){var I=[];var F=function(K,L){var M=[];for(var J in L){if(L.hasOwnProperty(J)){M.push(K+"_"+J+"="+L[J])}}return M.join("&")};for(var H in G){if(G.hasOwnProperty(H)){I.push((typeof G[H]==="object")?F(H,G[H]):H+"="+G[H])}}return I.join("&")};var A=function(H,G){var J=j(H);if(G.get("viewport")){var F=h(G.get("viewport"));J=J&&q(H,F)&&E(H)}else{J=J&&E(H)}var I=(G.get("gazetime")||"|").split("|");if(!(G.get("mark-expose")|0)&&J){l(r,G.get(v),G.get(b));G.set("gazetime",(+new Date)+"|")}else{if(I[0]){_logExposeTime(G.get(v),+new Date-I[0]);G.set("gazetime","|")}}return J};var w=function(){var G=h(this);var F=i(G);if(typeof F.get("watchid")!=="undefined"){h.each((e(G)).get(),function(){F.set("mark-expose",A(this,i(this)))})}else{F.set("mark-expose",A(G,F))}};var f=function(F){l("click",i(h(this).closest(".s")).get(v),0,this.href)};var k=function(F){h.each(o.expose,function(){var K=this.height();var J=s.height();if(K>J){var I=i(this);var H=this.offset().top;var G=s.scrollTop();if(G<H){I.set("mark-expose",0)}if(!(I.get("mark-expose")|0)&&G>(H+K-J)&&G<(H+K)){I.set("mark-expose",1);l(r,I.get(v),I.get(b))}}else{var I=i(this);I.set("mark-expose",A(this,I))}})};var z=function(F){var G;if(F){if(F.hasClass(D.replace(".",""))){G=F}else{G=F.find(D)}}else{G=h(D)}h.each(G,function(){var J=h(this);var I=i(J);if(I.get("inited")||!I.get(v)||!I.get(p)){return}if(I.get(p).indexOf(r)+1){J.attrchange(n(w,500));if(I.get("watch")){var H=h(I.get("watch"));(e(H)).add(J);H.attrchange(n(w,500))}o.expose.push(J)}if(I.get(p).indexOf(m)+1){J.delegate("a","mousedown",f)}I.set("inited",1)});if(!y){s.bind("scroll",n(k,500));s.bind("resize",n(k,500));setTimeout(function(){k()},100);y=true}};function j(F){return(F.css("display")!=="none"&&F.css("visibility")!=="hidden")}function q(G,F){if(G.length===0||F.length===0){return}var I=G.offset();var H=F.offset();return(I.left>=H.left&&I.left<H.left+F.width()&&I.top>=H.top&&I.top<H.top+F.height())}function E(F){if(F.length===0){return}var G=F[0].getBoundingClientRect();return(G.top>=0&&G.left>=0&&G.bottom<=g.innerHeight&&G.right<=g.innerWidth)}h.dstat={_export:function(){return u(l.cache)},init:z,send:C,log:l};h(function(){z()})})(jQuery);